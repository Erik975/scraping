<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Détails du site de presse</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      max-width: 900px;
      margin: 3rem auto;
      padding: 0 1.5rem;
      background-color: #f9fbfc;
      color: #1a2a4d;
      line-height: 1.6;
      display: flex;
      flex-direction: column;
      height: 90vh;
    }

    h1 {
      font-weight: 800;
      font-size: 2.5rem;
      color: #00204a;
      border-bottom: 3px solid #0059b3;
      padding-bottom: 0.6rem;
      margin-bottom: 1.5rem;
      letter-spacing: 0.03em;
    }

    .scroll-container {
      flex: 1;
      overflow-y: auto;
      padding-right: 0.5rem;
    }

    ul.dates-list {
      list-style: none;
      padding-left: 0;
      margin-bottom: 2rem;
      border-radius: 12px;
      background: #ffffff;
      box-shadow: 0 6px 20px rgb(0 0 0 / 0.05);
      padding: 1.5rem 2rem;
    }

    ul.dates-list li {
      margin-bottom: 1.1rem;
      font-size: 1.1rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      border-bottom: 1px solid #e3e9f3;
      padding-bottom: 0.7rem;
    }

    ul.dates-list li:last-child { border-bottom: none; }

    .date-header {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .date-link {
      text-decoration: none;
      color: #0073e6;
      font-weight: 600;
      padding: 0.35rem 0.75rem;
      border-radius: 8px;
      transition: all 0.3s ease;
      display: inline-block;
      box-shadow: 0 2px 6px rgb(0 115 230 / 0.15);
    }

    .date-link:hover {
      background-color: #0059b3;
      color: #fff;
      box-shadow: 0 4px 14px rgb(0 89 179 / 0.4);
    }

    ul.articles-list {
      margin: 0 0 0.8rem 1.2rem;
      padding-left: 1rem;
      list-style-type: disc;
      color: #444;
      font-size: 1rem;
      border-left: 2px solid #0059b3;
    }

    ul.articles-list li {
      margin-bottom: 0.3rem;
      line-height: 1.3;
    }

    .back-link {
      display: inline-block;
      margin-top: 1.5rem;
      color: #1a2a4d;
      text-decoration: none;
      border: 2px solid #1a2a4d;
      padding: 0.5rem 1.2rem;
      border-radius: 10px;
      font-weight: 600;
      font-size: 1.1rem;
      transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
      box-shadow: inset 0 0 0 0 #1a2a4d;
      align-self: flex-start;
    }

    .back-link:hover {
      background-color: #1a2a4d;
      color: #fff;
      box-shadow: 0 4px 15px rgb(26 42 77 / 0.5);
    }
  </style>
</head>
<body>
  <h1 id="siteTitle">Chargement...</h1>

  <div class="scroll-container">
    <ul class="dates-list" id="datesList"></ul>
  </div>

  <a href="index.html" class="back-link">← Retour à la liste</a>

  <script>
    let data = null;

    function getParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    function formatDateString(dateStr) {
      const d = new Date(dateStr.slice(0,4) + "-" + dateStr.slice(4,6) + "-" + dateStr.slice(6,8));
      const months = ["janvier", "février", "mars", "avril", "mai", "juin",
                      "juillet", "août", "septembre", "octobre", "novembre", "décembre"];
      return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}`;
    }

    function groupArticlesByDate(articles) {
      const grouped = {};
      articles.forEach(article => {
        const dateKey = article.date.slice(0, 10).replace(/-/g, ""); // ex: 2025-08-01 → 20250801
        if (!grouped[dateKey]) grouped[dateKey] = [];
        grouped[dateKey].push(article.titre);
      });
      return grouped;
    }

    function displayDates(provider, articles) {
      const datesInfo = groupArticlesByDate(articles);
      const sortedDates = Object.keys(datesInfo).sort().reverse();

      const html = sortedDates.map(date => {
        const titles = datesInfo[date];
        const syntheseLink = `toolbar.html?source=${provider}&date=${date}`;

        const titlesHtml = `<ul class="articles-list">${titles.map(t => `<li>${t}</li>`).join('')}</ul>`;

        return `
          <li>
            <div class="date-header">
              <a href="${syntheseLink}" target="_blank" rel="noopener" class="date-link">${formatDateString(date)}</a>
            </div>
            ${titlesHtml}
          </li>
        `;
      }).join("");

      document.getElementById("datesList").innerHTML = html;
    }

    function init() {
      const provider = getParam("site");
      const titleEl = document.getElementById("siteTitle");

      if (!provider) {
        titleEl.textContent = "❌ Site de presse non spécifié.";
        return;
      }

      // Filtrer articles selon provider
      const filtered = data.articles.filter(a => a.provider === provider);

      if (filtered.length === 0) {
        titleEl.textContent = `Aucun article pour ${provider}`;
        document.getElementById("datesList").innerHTML = "<li>Aucune synthèse disponible pour ce site.</li>";
        return;
      }

      titleEl.textContent = provider.replace(/_/g, " ");
      displayDates(provider, filtered);
    }

    // Chargement du fichier JSON avant init
    fetch('data.json')
      .then(response => {
        if (!response.ok) throw new Error('Erreur de chargement du fichier JSON');
        return response.json();
      })
      .then(json => {
        data = json;
        init();
      })
      .catch(error => {
        document.getElementById("siteTitle").textContent = "Erreur : " + error.message;
      });
  </script>
</body>
</html>

